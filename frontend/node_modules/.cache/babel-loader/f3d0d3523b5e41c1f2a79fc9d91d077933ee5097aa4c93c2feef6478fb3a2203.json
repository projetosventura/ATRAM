{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Typography,Box,IconButton,Snackbar,CircularProgress}from'@mui/material';import{ContentCopy as ContentCopyIcon,Close as CloseIcon}from'@mui/icons-material';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL='/api';const InspectionRequestButton=_ref=>{let{truck,vehicleSet,driver,onComplete}=_ref;const[open,setOpen]=useState(false);const[loading,setLoading]=useState(false);const[inspectionUrl,setInspectionUrl]=useState('');const[snackbarOpen,setSnackbarOpen]=useState(false);const[error,setError]=useState(null);useEffect(()=>{if((truck||vehicleSet)&&driver){handleCreateRequest();}},[truck,vehicleSet,driver]);const handleCreateRequest=async()=>{setLoading(true);setError(null);try{const requestData={driver_id:driver.id};// Se for um conjunto de veículos, usar vehicle_set_id, senão usar truck_id para compatibilidade\nif(vehicleSet){requestData.vehicle_set_id=vehicleSet.id;}else if(truck){requestData.truck_id=truck.id;}const response=await axios.post(`${API_URL}/inspection-requests`,requestData);const baseUrl=window.location.origin;const fullUrl=`${baseUrl}/inspection/${response.data.request.token}`;setInspectionUrl(fullUrl);setOpen(true);}catch(error){console.error('Error creating inspection request:',error);setError('Erro ao criar solicitação de vistoria');}finally{setLoading(false);}};const handleCopyUrl=()=>{navigator.clipboard.writeText(inspectionUrl);setSnackbarOpen(true);};const handleClose=()=>{setOpen(false);if(onComplete){onComplete();}};if(loading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:2},children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error){return/*#__PURE__*/_jsx(Typography,{color:\"error\",align:\"center\",children:error});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Link de Vistoria\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Typography,{gutterBottom:true,children:\"Compartilhe este link com o motorista para que ele possa preencher a vistoria:\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,mt:2},children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,value:inspectionUrl,InputProps:{readOnly:true}}),/*#__PURE__*/_jsx(IconButton,{onClick:handleCopyUrl,color:\"primary\",children:/*#__PURE__*/_jsx(ContentCopyIcon,{})})]})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:handleClose,children:\"Fechar\"})})]}),/*#__PURE__*/_jsx(Snackbar,{open:snackbarOpen,autoHideDuration:3000,onClose:()=>setSnackbarOpen(false),message:\"Link copiado para a \\xE1rea de transfer\\xEAncia\",action:/*#__PURE__*/_jsx(IconButton,{size:\"small\",color:\"inherit\",onClick:()=>setSnackbarOpen(false),children:/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"small\"})})})]});};export default InspectionRequestButton;","map":{"version":3,"names":["React","useState","useEffect","Button","Dialog","DialogTitle","DialogContent","DialogActions","TextField","Typography","Box","IconButton","Snackbar","CircularProgress","ContentCopy","ContentCopyIcon","Close","CloseIcon","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_URL","InspectionRequestButton","_ref","truck","vehicleSet","driver","onComplete","open","setOpen","loading","setLoading","inspectionUrl","setInspectionUrl","snackbarOpen","setSnackbarOpen","error","setError","handleCreateRequest","requestData","driver_id","id","vehicle_set_id","truck_id","response","post","baseUrl","window","location","origin","fullUrl","data","request","token","console","handleCopyUrl","navigator","clipboard","writeText","handleClose","sx","display","justifyContent","p","children","color","align","onClose","maxWidth","fullWidth","gutterBottom","alignItems","gap","mt","value","InputProps","readOnly","onClick","autoHideDuration","message","action","size","fontSize"],"sources":["D:/Estudos/ATRAM/frontend/src/components/inspections/InspectionRequestButton.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Button,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  Typography,\r\n  Box,\r\n  IconButton,\r\n  Snackbar,\r\n  CircularProgress,\r\n} from '@mui/material';\r\nimport {\r\n  ContentCopy as ContentCopyIcon,\r\n  Close as CloseIcon,\r\n} from '@mui/icons-material';\r\nimport axios from 'axios';\r\n\r\nconst API_URL = '/api';\r\n\r\nconst InspectionRequestButton = ({ truck, vehicleSet, driver, onComplete }) => {\r\n  const [open, setOpen] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [inspectionUrl, setInspectionUrl] = useState('');\r\n  const [snackbarOpen, setSnackbarOpen] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if ((truck || vehicleSet) && driver) {\r\n      handleCreateRequest();\r\n    }\r\n  }, [truck, vehicleSet, driver]);\r\n\r\n  const handleCreateRequest = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const requestData = {\r\n        driver_id: driver.id\r\n      };\r\n\r\n      // Se for um conjunto de veículos, usar vehicle_set_id, senão usar truck_id para compatibilidade\r\n      if (vehicleSet) {\r\n        requestData.vehicle_set_id = vehicleSet.id;\r\n      } else if (truck) {\r\n        requestData.truck_id = truck.id;\r\n      }\r\n\r\n      const response = await axios.post(`${API_URL}/inspection-requests`, requestData);\r\n\r\n      const baseUrl = window.location.origin;\r\n      const fullUrl = `${baseUrl}/inspection/${response.data.request.token}`;\r\n      setInspectionUrl(fullUrl);\r\n      setOpen(true);\r\n    } catch (error) {\r\n      console.error('Error creating inspection request:', error);\r\n      setError('Erro ao criar solicitação de vistoria');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCopyUrl = () => {\r\n    navigator.clipboard.writeText(inspectionUrl);\r\n    setSnackbarOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n    if (onComplete) {\r\n      onComplete();\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Box sx={{ display: 'flex', justifyContent: 'center', p: 2 }}>\r\n        <CircularProgress />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Typography color=\"error\" align=\"center\">\r\n        {error}\r\n      </Typography>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onClose={handleClose} maxWidth=\"sm\" fullWidth>\r\n        <DialogTitle>Link de Vistoria</DialogTitle>\r\n        <DialogContent>\r\n          <Typography gutterBottom>\r\n            Compartilhe este link com o motorista para que ele possa preencher a vistoria:\r\n          </Typography>\r\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 2 }}>\r\n            <TextField\r\n              fullWidth\r\n              value={inspectionUrl}\r\n              InputProps={{\r\n                readOnly: true,\r\n              }}\r\n            />\r\n            <IconButton onClick={handleCopyUrl} color=\"primary\">\r\n              <ContentCopyIcon />\r\n            </IconButton>\r\n          </Box>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose}>Fechar</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      <Snackbar\r\n        open={snackbarOpen}\r\n        autoHideDuration={3000}\r\n        onClose={() => setSnackbarOpen(false)}\r\n        message=\"Link copiado para a área de transferência\"\r\n        action={\r\n          <IconButton\r\n            size=\"small\"\r\n            color=\"inherit\"\r\n            onClick={() => setSnackbarOpen(false)}\r\n          >\r\n            <CloseIcon fontSize=\"small\" />\r\n          </IconButton>\r\n        }\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default InspectionRequestButton; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}